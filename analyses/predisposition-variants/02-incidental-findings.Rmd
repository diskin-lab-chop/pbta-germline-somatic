---
title: 'Prevalence of germline P-LP variants in predisposition-syndrome-associated genes'
output: 
  html_document:
  toc: TRUE
toc_float: TRUE
author: Ryan Corbett
date: "2023"
---

Load packages and set directories

```{r load libraries}
suppressPackageStartupMessages({
  library(data.table)
  library(tidyverse)
  library(stringr)
})

root_dir <- rprojroot::find_root(rprojroot::has_dir(".git"))
setwd(root_dir)

data_dir <- file.path(root_dir, "data")
analysis_dir <- file.path(root_dir, "analyses", "predisposition-variants")
input_dir <- file.path(analysis_dir, "input")
results_dir <- file.path(analysis_dir, "results")
```

Set paths for: 
- histologies file, 
- germline plp variant file
- predisposition syndromes files

```{r set paths}
histologies_file <- file.path(root_dir, 'analyses', 'collapse-tumor-histologies', 'results',"germline-primary-plus-tumor-histologies-plot-groups-clin-meta.tsv")

plp_file <- file.path(data_dir, "pbta_germline_plp_calls.tsv")

predispositions_file <- file.path(input_dir, "predisposition-syndromes.tsv")
```

Read in histologies, germline PLP, and predispositions file

```{r read files}
hist <- read_tsv(histologies_file,show_col_types = FALSE) 

plp <- read_tsv(plp_file,show_col_types = FALSE)

predispositions <- read_tsv(predispositions_file)
```

See which cancer predispositions are currently reported in histologies file: 

```{r get predispositions}
table(hist$cancer_predispositions)
```

Subset PLP file to include only variants in CPGs associated with syndromes in `predispositions`, and include `cancer_predispositions` column to indicate whether syndrome is currently reported.

```{r }
predisposition_plp_bs <- plp %>%
  filter(Hugo_Symbol %in% predispositions$Hugo_Symbol) %>%
  pull(Kids_First_Biospecimen_ID)

plp_predisposition_syndromes <- hist %>%
  filter(Kids_First_Biospecimen_ID_normal %in% predisposition_plp_bs) %>%
  dplyr::rename("Kids_First_Biospecimen_ID" = Kids_First_Biospecimen_ID_normal) %>%
  left_join(plp[,c("Kids_First_Biospecimen_ID", "Hugo_Symbol", "L-LP_Call_final", "Reasoning_for_call", "HGVS.c", "HGVS.p")]) %>%
  left_join(predispositions) %>%
  filter(Hugo_Symbol %in% predispositions$Hugo_Symbol) %>%
  dplyr::rename("associated_syndrome" = `Associated Syndrome`,
                "clinically_reported_syndrome" = cancer_predispositions) %>%
  dplyr::mutate(incidental_finding = case_when(
    !str_detect(associated_syndrome, clinically_reported_syndrome) ~ "Yes",
    TRUE ~ "No"
  )) %>%
  select(Kids_First_Participant_ID, Kids_First_Biospecimen_ID, plot_group, molecular_subtype, 
         Hugo_Symbol, `L-LP_Call_final`, Reasoning_for_call, HGVS.c, HGVS.p,
         associated_syndrome, clinically_reported_syndrome, incidental_finding)
```

Save output

```{r}
write_tsv(plp_predisposition_syndromes,
          file.path(results_dir, "incidental-findings-predisposition-variants.tsv"))
```
